# Web比較ビューア（同期スクロール）

2つのWebページを左右に並べ、幅プリセット（PC 1920px / SP 375px）をワンクリックで切り替えつつ、スクロールを同期させて比較できるローカルツールです。HTMLをサーバ側でプロキシし、iframe制限や相対パス崩れを極力回避します。

---

## 主な機能
- 2つのURLを左右に表示（iframe）
- PC（1920px）/ SP（375px）で両ページの表示幅を同時切替
- スクロール同期（比率同期）で左右のスクロール位置を自動的に揃える
- サーバ側プロキシでHTMLを取得し、`<base>`注入 + リンク/GETフォームの遷移を自動的にプロキシ化

## 動作要件
- Node.js 18以降（推奨：最新のLTS）
- インターネット接続

## セットアップと起動
1. 依存関係のインストール
   ```bash
   npm install
   ```
2. サーバの起動
   ```bash
   npm start
   ```
   - デフォルトポートは `3000` です。変更したい場合は以下のように環境変数を指定できます。
     ```bash
     PORT=3001 npm start
     ```
3. ブラウザで開く
   - `http://localhost:3000`

## 使い方
- 画面上部に「同期スクロール」トグルと、幅切替ボタン（PC 1920px / SP 375px）があります。
- その下に左右それぞれのURL入力欄と「読み込み」ボタンがあります。
  - URL入力後にEnterでも読み込めます。
- 読み込み後、左右のページは並んで表示されます。
  - 幅切替ボタンを押すと、両方の表示幅が同時に変わります。
  - 「同期スクロール」をONのままスクロールすると、左右が比率で同期します。
- ページ内リンクをクリックした場合も、可能な限り自動的に `/proxy?url=...` を介して遷移するため、比較を継続しやすくなっています。

## 制限事項・注意点
- すべてのサイトで完全な表示・動作を保証するものではありません。
  - ログインが必要なページ、ボット対策が厳しいサイト、CSP（Content Security Policy）が強いサイトは表示が崩れたり取得に失敗する場合があります。
  - 本ツールはHTML本文をプロキシして `<base>` を注入し、リンク/GETフォーム遷移をプロキシ化します。POST送信やJavaScriptによる遷移（`window.location=` など）は未対応です（拡張で対応可能）。
  - 画像・CSS・JSなどのリソースは基本的に元サイトから直接読み込まれ、CORSやMixed Contentの影響を受けることがあります。
- セキュリティ
  - 簡易プロキシであり、ローカル開発用途を想定しています。インターネットに公開しないでください。
  - 信頼できるURLのみを扱ってください。悪意のあるサイトのHTMLをプロキシすることは危険です。

## ディレクトリ構成
- `server.js`: Expressサーバおよび `/proxy` 実装（HTMLに`<base>`と挙動フック用スクリプトを注入）
- `public/index.html`: UI本体（左右URL入力、幅切替、同期スクロールトグル、2枚のiframe）
- `public/styles.css`: レイアウト・スタイル（幅はCSSカスタムプロパティ `--frame-width`）
- `public/app.js`: URL読み込み、幅切替、同期スクロール制御などのクライアントロジック
- `package.json`: 依存関係と起動スクリプト

## 拡張アイデア（任意）
- POSTフォームのプロキシ対応、History API/`window.location` のフック
- 任意幅入力やプリセット追加、デバイスごとのUA切替
- 縦幅ロック、スクロール位置/倍率のプリセット保存
- 左右入れ替え、スクリーンショット保存機能

---

## トラブルシューティング
- ページが表示されない / 真っ白
  - 先方サイトのCSPやボット対策でブロックされている可能性があります。別のページで試してください。
- 同期スクロールが効かない
  - プロキシ経由でないページに遷移してしまっている可能性があります。最初のURL読み込みからやり直してください。
- サーバが起動しない
  - 既にポート3000を使っているプロセスがあるかもしれません。`PORT=3001 npm start` など、別ポートで起動してください。

---

## ライセンス
- ローカル検証用途を想定したサンプルです。ご利用環境や規約に従ってご使用ください。
